<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Interactive 3D World</title>

    <style>
        body { margin: 0; overflow: hidden; }
        canvas { display: block; }
        #instructions {
            position: absolute;
            top: 0; left: 0;
            width: 100%; height: 100%;
            background: rgba(0,0,0,0.85);
            color: white;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 28px;
            text-align: center;
            cursor: pointer;
        }
    </style>
</head>
<body>

<div id="instructions">Click to start<br>WASD + Mouse to Move</div>

<script type="module">
import * as THREE from "https://cdn.jsdelivr.net/npm/three@0.158/build/three.module.js";
import { PointerLockControls } from "https://cdn.jsdelivr.net/npm/three@0.158/examples/jsm/controls/PointerLockControls.js";


// ---------------------------------------------------------
// BASIC THREE SETUP
// ---------------------------------------------------------

const scene = new THREE.Scene();
scene.background = new THREE.Color(0x87ceeb);  // sky blue

const camera = new THREE.PerspectiveCamera(
    75,
    window.innerWidth / window.innerHeight,
    0.1,
    2000
);
camera.position.set(0, 5, 10);

const renderer = new THREE.WebGLRenderer({ antialias: true });
renderer.setSize(window.innerWidth, window.innerHeight);
document.body.appendChild(renderer.domElement);


// ---------------------------------------------------------
// LIGHTING
// ---------------------------------------------------------

const sun = new THREE.DirectionalLight(0xffffff, 1);
sun.position.set(100, 200, 50);
scene.add(sun);

scene.add(new THREE.AmbientLight(0xffffff, 0.4));


// ---------------------------------------------------------
// TERRAIN (Large Plane)
// ---------------------------------------------------------

const terrainGeo = new THREE.PlaneGeometry(600, 600, 200, 200);
terrainGeo.rotateX(-Math.PI / 2);

for (let i = 0; i < terrainGeo.attributes.position.count; i++) {
    let x = terrainGeo.attributes.position.getX(i);
    let z = terrainGeo.attributes.position.getZ(i);

    // simple height using sin waves
    let height =
        Math.sin(x * 0.02) * 5 +
        Math.sin(z * 0.02) * 5 +
        Math.sin(x * 0.04) * 3;

    terrainGeo.attributes.position.setY(i, height);
}

terrainGeo.computeVertexNormals();

const terrainMat = new THREE.MeshStandardMaterial({
    color: 0x228833,
    flatShading: false
});

const terrain = new THREE.Mesh(terrainGeo, terrainMat);
terrain.receiveShadow = true;
scene.add(terrain);


// ---------------------------------------------------------
// A FEW OBJECTS
// ---------------------------------------------------------

const boxGeo = new THREE.BoxGeometry(5, 5, 5);
const boxMat = new THREE.MeshStandardMaterial({ color: 0xff4444 });

for (let i = 0; i < 10; i++) {
    let box = new THREE.Mesh(boxGeo, boxMat);
    box.position.set(
        Math.random() * 200 - 100,
        5,
        Math.random() * 200 - 100
    );
    scene.add(box);
}


// ---------------------------------------------------------
// PLAYER CONTROLS (Pointer Lock + WASD)
// ---------------------------------------------------------

const controls = new PointerLockControls(camera, renderer.domElement);

document.getElementById("instructions").addEventListener("click", () => {
    controls.lock();
});

controls.addEventListener("lock", () => {
    document.getElementById("instructions").style.display = "none";
});
controls.addEventListener("unlock", () => {
    document.getElementById("instructions").style.display = "flex";
});

// movement state
const keys = {
    w: false,
    a: false,
    s: false,
    d: false
};

document.addEventListener("keydown", (e) => {
    if (keys[e.key.toLowerCase()] !== undefined) keys[e.key] = true;
});

document.addEventListener("keyup", (e) => {
    if (keys[e.key.toLowerCase()] !== undefined) keys[e.key] = false;
});

// movement speed
const speed = 0.15;


// ---------------------------------------------------------
// ANIMATION LOOP
// ---------------------------------------------------------

function animate() {
    requestAnimationFrame(animate);

    // movement
    if (controls.isLocked) {
        if (keys.w) controls.moveForward(speed);
        if (keys.s) controls.moveForward(-speed);
        if (keys.a) controls.moveRight(-speed);
        if (keys.d) controls.moveRight(speed);
    }

    renderer.render(scene, camera);
}

animate();


// ---------------------------------------------------------
// WINDOW RESIZE SUPPORT
// ---------------------------------------------------------

window.addEventListener("resize", () => {
    camera.aspect = window.innerWidth / window.innerHeight;
    camera.updateProjectionMatrix();
    renderer.setSize(window.innerWidth, window.innerHeight);
});
</script>

</body>
</html>
