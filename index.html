<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Interactive 3D World</title>

    <style>
        body { margin: 0; overflow: hidden; background: black; }
        #instructions {
            position: absolute;
            top: 0; left: 0;
            width: 100%; height: 100%;
            background: rgba(0,0,0,0.8);
            color: white;
            font-size: 32px;
            display: flex;
            justify-content: center;
            align-items: center;
            cursor: pointer;
            text-align: center;
        }
    </style>
</head>
<body>

<div id="instructions">Click to Start<br><br>WASD = Move<br>Mouse = Look Around</div>

<script type="module">

// -----------------------------------------------------
// IMPORTS
// -----------------------------------------------------
import * as THREE from "https://cdn.jsdelivr.net/npm/three@0.158/build/three.module.js";
import { PointerLockControls } from "https://cdn.jsdelivr.net/npm/three@0.158/examples/jsm/controls/PointerLockControls.js";


// -----------------------------------------------------
// SCENE + CAMERA + RENDERER
// -----------------------------------------------------
const scene = new THREE.Scene();
scene.background = new THREE.Color(0x87ceeb); // sky blue

const camera = new THREE.PerspectiveCamera(
    75,
    window.innerWidth / window.innerHeight,
    0.1,
    2000
);
camera.position.set(0, 10, 10);

const renderer = new THREE.WebGLRenderer({ antialias: true });
renderer.setSize(window.innerWidth, window.innerHeight);
document.body.appendChild(renderer.domElement);


// -----------------------------------------------------
// LIGHTS
// -----------------------------------------------------
const light = new THREE.DirectionalLight(0xffffff, 1);
light.position.set(100, 200, 100);
scene.add(light);

scene.add(new THREE.AmbientLight(0xffffff, 0.5));


// -----------------------------------------------------
// TERRAIN
// -----------------------------------------------------
const terrainGeo = new THREE.PlaneGeometry(600, 600, 200, 200);
terrainGeo.rotateX(-Math.PI / 2);

for (let i = 0; i < terrainGeo.attributes.position.count; i++) {
    let x = terrainGeo.attributes.position.getX(i);
    let z = terrainGeo.attributes.position.getZ(i);

    // simple height
    let height =
        Math.sin(x * 0.03) * 4 +
        Math.sin(z * 0.03) * 4 +
        Math.sin(x * 0.01) * 2;

    terrainGeo.attributes.position.setY(i, height);
}

terrainGeo.computeVertexNormals();

const terrain = new THREE.Mesh(
    terrainGeo,
    new THREE.MeshStandardMaterial({ color: 0x228833 })
);

terrain.receiveShadow = true;
scene.add(terrain);


// -----------------------------------------------------
// RANDOM BOX OBJECTS
// -----------------------------------------------------
const boxGeo = new THREE.BoxGeometry(4, 4, 4);
const boxMat = new THREE.MeshStandardMaterial({ color: 0xff5555 });

for (let i = 0; i < 12; i++) {
    let box = new THREE.Mesh(boxGeo, boxMat);
    box.position.set(
        Math.random() * 300 - 150,
        5,
        Math.random() * 300 - 150
    );
    scene.add(box);
}


// -----------------------------------------------------
// PLAYER CONTROLS (Pointer Lock)
// -----------------------------------------------------
const controls = new PointerLockControls(camera, document.body);

const instructions = document.getElementById("instructions");

instructions.addEventListener("click", () => {
    controls.lock();
});

controls.addEventListener("lock", () => {
    instructions.style.display = "none";
});

controls.addEventListener("unlock", () => {
    instructions.style.display = "flex";
});


// -----------------------------------------------------
// MOVEMENT KEYS
// -----------------------------------------------------
const keys = {
    w: false,
    a: false,
    s: false,
    d: false
};

document.addEventListener("keydown", (e) => {
    if (keys[e.key.toLowerCase()] !== undefined) {
        keys[e.key.toLowerCase()] = true;
    }
});

document.addEventListener("keyup", (e) => {
    if (keys[e.key.toLowerCase()] !== undefined) {
        keys[e.key.toLowerCase()] = false;
    }
});

const moveSpeed = 0.18;


// -----------------------------------------------------
// GAME LOOP
// -----------------------------------------------------
function animate() {
    requestAnimationFrame(animate);

    if (controls.isLocked) {
        if (keys.w) controls.moveForward(moveSpeed);
        if (keys.s) controls.moveForward(-moveSpeed);
        if (keys.a) controls.moveRight(-moveSpeed);
        if (keys.d) controls.moveRight(moveSpeed);
    }

    renderer.render(scene, camera);
}

animate();


// -----------------------------------------------------
// RESIZE HANDLER
// -----------------------------------------------------
window.addEventListener("resize", () => {
    camera.aspect = window.innerWidth / window.innerHeight;
    camera.updateProjectionMatrix();
    renderer.setSize(window.innerWidth, window.innerHeight);
});

</script>

</body>
</html>
