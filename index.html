<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<title>NovaEngine Studio Lite</title>
<style>
body,html{
  margin:0;padding:0;overflow:hidden;
  font-family:Segoe UI;background:#181818;color:#eee;
}
#topbar{
  position:fixed;top:0;left:0;right:0;height:40px;
  background:#222;display:flex;align-items:center;
  gap:8px;padding:0 10px;z-index:10;
}
button,select,input{
  background:#333;border:1px solid #555;color:#eee;
  padding:5px 8px;border-radius:4px;cursor:pointer;
}
#leftPanel{
  position:fixed;top:40px;bottom:0;left:0;width:200px;
  background:#202020;padding:10px;overflow-y:auto;
}
#rightPanel{
  position:fixed;top:40px;bottom:0;right:0;width:250px;
  background:#202020;padding:10px;overflow-y:auto;
}
.panelTitle{
  font-weight:bold;margin-bottom:8px;
  border-bottom:1px solid #444;padding-bottom:5px;
}
#viewport{
  position:fixed;top:40px;left:200px;right:250px;bottom:0;
}
.hItem{padding:4px;border-radius:3px;cursor:pointer;}
.hItem.selected{background:#3a81f7;}
</style>
</head>
<body>

<div id="topbar">
  <button id="addCube">Cube</button>
  <button id="addSphere">Sphere</button>
  <button id="makeTerrain">Terrain</button>
  <select id="paintType">
    <option value="grass">Grass</option>
    <option value="rock">Rock</option>
    <option value="sand">Sand</option>
  </select>
  <button id="playBtn">Play</button>
</div>

<div id="leftPanel">
  <div class="panelTitle">Workspace</div>
  <div id="hierarchy"></div>
</div>

<div id="rightPanel">
  <div class="panelTitle">Properties</div>
  <div id="props">Select an object</div>
</div>

<div id="viewport"></div>

<script src="https://cdn.jsdelivr.net/npm/three@0.152.2/build/three.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/three@0.152.2/examples/js/controls/OrbitControls.js"></script>
<script src="https://cdn.jsdelivr.net/npm/three@0.152.2/examples/js/controls/TransformControls.js"></script>

<script>
let scene,camera,renderer,orbit,transform,terrain=null;
let selected=null, objects=[], playMode=false, player=null;
let keys={}, paint="grass";

init();

function init(){
  scene=new THREE.Scene();
  scene.background=new THREE.Color(0x202020);

  camera=new THREE.PerspectiveCamera(60,window.innerWidth/window.innerHeight,0.1,1000);
  camera.position.set(10,10,10);

  renderer=new THREE.WebGLRenderer({antialias:true});
  renderer.setSize(window.innerWidth,window.innerHeight);
  document.getElementById("viewport").appendChild(renderer.domElement);

  orbit=new THREE.OrbitControls(camera,renderer.domElement);
  orbit.enableDamping=true;

  transform=new THREE.TransformControls(camera,renderer.domElement);
  transform.addEventListener("dragging-changed",e=>orbit.enabled=!e.value);
  scene.add(transform);

  const light=new THREE.DirectionalLight(0xffffff,1);
  light.position.set(10,20,10);
  scene.add(light);
  scene.add(new THREE.AmbientLight(0xffffff,0.3));

  const grid=new THREE.GridHelper(200,200);
  scene.add(grid);

  renderer.domElement.addEventListener("pointerdown",selectByClick);
  window.addEventListener("resize",resize);
  window.addEventListener("keydown",e=>keys[e.key]=true);
  window.addEventListener("keyup",e=>keys[e.key]=false);

  document.getElementById("addCube").onclick=()=>addObject("cube");
  document.getElementById("addSphere").onclick=()=>addObject("sphere");
  document.getElementById("makeTerrain").onclick=makeTerrain;
  document.getElementById("paintType").onchange=e=>paint=e.target.value;
  document.getElementById("playBtn").onclick=togglePlay;

  animate();
}

function resize(){
  camera.aspect=window.innerWidth/window.innerHeight;
  camera.updateProjectionMatrix();
  renderer.setSize(window.innerWidth,window.innerHeight);
}

function animate(){
  requestAnimationFrame(animate);
  if(playMode && player) updatePlayer();
  orbit.update();
  renderer.render(scene,camera);
}

function addObject(type){
  if(playMode) return;
  let mesh;
  if(type==="cube")
    mesh=new THREE.Mesh(new THREE.BoxGeometry(1,1,1),
        new THREE.MeshStandardMaterial({color:0x00aaff}));
  if(type==="sphere")
    mesh=new THREE.Mesh(new THREE.SphereGeometry(0.6,32,32),
        new THREE.MeshStandardMaterial({color:0xff6666}));

  mesh.position.set(0,1,0);
  mesh.userData.id="obj"+objects.length;
  objects.push(mesh);
  scene.add(mesh);
  select(mesh);
  refreshHierarchy();
}

function makeTerrain(){
  if(terrain) scene.remove(terrain);
  const size=200, seg=150;
  const geo=new THREE.PlaneGeometry(size,size,seg,seg);
  geo.rotateX(-Math.PI/2);

  const pos=geo.attributes.position;
  for(let i=0;i<pos.count;i++){
    let x=pos.getX(i),z=pos.getZ(i);
    const dist=Math.sqrt(x*x+z*z);
    if(dist>40){
      let h=(dist-40)/60;
      pos.setY(i,Math.sin(x*0.05)*4+Math.cos(z*0.05)*4+h*20);
    }
  }
  pos.needsUpdate=true;
  geo.computeVertexNormals();

  const mat=new THREE.MeshStandardMaterial({color:0x228833});
  terrain=new THREE.Mesh(geo,mat);
  terrain.userData.id="terrain";
  terrain.userData.type="terrain";
  scene.add(terrain);
  refreshHierarchy();
}

function selectByClick(e){
  if(playMode) return;
  const mouse=new THREE.Vector2(
    (e.clientX/window.innerWidth)*2-1,
    -(e.clientY/window.innerHeight)*2+1
  );
  const ray=new THREE.Raycaster();
  ray.setFromCamera(mouse,camera);
  const hits=ray.intersectObjects(objects.concat(terrain?terrain:null),true);
  if(hits.length>0) select(hits[0].object);
}

function select(obj){
  selected=obj;
  transform.attach(obj);
  updateProps();
  refreshHierarchy();
}

function refreshHierarchy(){
  let html="";
  if(terrain) html+=`<div class="hItem ${selected===terrain?"selected":""}" 
      onclick="select(terrain)">Terrain</div>`;
  for(const o of objects){
    html+=`<div class="hItem ${selected===o?"selected":""}" 
      onclick="select(objects[${objects.indexOf(o)}])">${o.userData.id}</div>`;
  }
  document.getElementById("hierarchy").innerHTML=html;
}

function updateProps(){
  if(!selected){
    document.getElementById("props").innerHTML="Select an object";
    return;
  }
  const p=selected.position;
  const html=`
    <div>Position</div>
    X: <input id="px" type="number" step="0.1" value="${p.x}">
    Y: <input id="py" type="number" step="0.1" value="${p.y}">
    Z: <input id="pz" type="number" step="0.1" value="${p.z}">
  `;
  document.getElementById("props").innerHTML=html;

  px.oninput=()=>{selected.position.x=parseFloat(px.value)};
  py.oninput=()=>{selected.position.y=parseFloat(py.value)};
  pz.oninput=()=>{selected.position.z=parseFloat(pz.value)};
}

function togglePlay(){
  if(!playMode) enterPlay(); else exitPlay();
}

function enterPlay(){
  playMode=true;
  transform.detach();
  orbit.enabled=false;

  player=new THREE.Mesh(
    new THREE.BoxGeometry(1,1.8,1),
    new THREE.MeshStandardMaterial({color:0xffdd55})
  );
  player.position.set(0,5,0);
  scene.add(player);

  document.getElementById("playBtn").innerText="Stop";
}

function exitPlay(){
  playMode=false;
  orbit.enabled=true;
  scene.remove(player);
  player=null;
  document.getElementById("playBtn").innerText="Play";
}

function updatePlayer(){
  const speed= keys["shift"]?0.2:0.1;
  if(keys["w"]) player.position.z -= speed;
  if(keys["s"]) player.position.z += speed;
  if(keys["a"]) player.position.x -= speed;
  if(keys["d"]) player.position.x += speed;
  if(keys[" "] && player.position.y<=1.01) player.position.y += 0.4;
  player.position.y -= 0.05;
  if(player.position.y<1) player.position.y=1;

  camera.position.set(
    player.position.x+5,
    player.position.y+4,
    player.position.z+5
  );
  camera.lookAt(player.position);
}
</script>
</body>
</html>
