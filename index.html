<!DOCTYPE html>
<html>
<head>
    <title>Regina Multiplayer Map</title>
    <meta charset="UTF-8">
    <style>
        body {
            background: #eef2f3;
            font-family: Arial, sans-serif;
            text-align: center;
            margin: 0;
            padding: 20px;
        }

        h1 {
            margin-top: 0;
        }

        canvas {
            border: 2px solid #333;
            background: #c8e6ff; /* Regina sky */
            display: block;
            margin: auto;
        }
    </style>
</head>
<body>

<h1>Regina, Saskatchewan â€“ Multiplayer Map</h1>
<p>Move with WASD or Arrow Keys. Open in multiple tabs to test.</p>

<canvas id="gameCanvas" width="900" height="600"></canvas>

<!-- Socket.IO auto-loads from your local server -->
<script src="/socket.io/socket.io.js"></script>

<script>
/* ---------------------------------------------
   CONNECT TO SERVER
---------------------------------------------- */
const socket = io();

/* ---------------------------------------------
   CANVAS SETUP
---------------------------------------------- */
const canvas = document.getElementById("gameCanvas");
const ctx = canvas.getContext("2d");

let players = {};
let myId = "";
let speed = 4;

/* ---------------------------------------------
   NETWORK EVENTS
---------------------------------------------- */
socket.on("currentPlayers", (data) => {
    players = data;
    myId = socket.id;
});

socket.on("newPlayer", (player) => {
    players[player.id] = player;
});

socket.on("playerDisconnected", (id) => {
    delete players[id];
});

socket.on("playerMoved", (player) => {
    players[player.id] = player;
});

/* ---------------------------------------------
   KEYBOARD MOVEMENT
---------------------------------------------- */
let keys = {};
document.addEventListener("keydown", (e) => keys[e.key] = true);
document.addEventListener("keyup", (e) => keys[e.key] = false);

/* ---------------------------------------------
   DRAW REGINA MAP (simple landmarks)
---------------------------------------------- */
function drawReginaMap() {
    // Wascana Lake
    ctx.fillStyle = "#6ec6ff";
    ctx.fillRect(200, 150, 500, 250);

    // Legislature Building
    ctx.fillStyle = "#d4c39a";
    ctx.fillRect(380, 200, 140, 60);

    // Simple downtown grid
    ctx.fillStyle = "#bdbdbd";
    ctx.fillRect(100, 50, 100, 100);
    ctx.fillRect(250, 50, 100, 100);
    ctx.fillRect(400, 50, 100, 100);
}

/* ---------------------------------------------
   MAIN GAME LOOP
---------------------------------------------- */
function gameLoop() {
    ctx.clearRect(0, 0, canvas.width, canvas.height);

    drawReginaMap();

    // Move local player
    let me = players[myId];
    if (me) {
        if (keys["ArrowUp"] || keys["w"]) me.y -= speed;
        if (keys["ArrowDown"] || keys["s"]) me.y += speed;
        if (keys["ArrowLeft"] || keys["a"]) me.x -= speed;
        if (keys["ArrowRight"] || keys["d"]) me.x += speed;

        socket.emit("move", { x: me.x, y: me.y });
    }

    // Draw players
    for (let id in players) {
        let p = players[id];
        ctx.fillStyle = p.color;
        ctx.beginPath();
        ctx.arc(p.x, p.y, 10, 0, Math.PI * 2);
        ctx.fill();

        ctx.fillStyle = "black";
        ctx.fillText(p.name, p.x - 15, p.y - 15);
    }

    requestAnimationFrame(gameLoop);
}

gameLoop();
</script>

</body>
</html>
